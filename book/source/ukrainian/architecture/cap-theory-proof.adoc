ifndef::imagesdir[:imagesdir: ../../imgs/architecture/]

[#cap-theory-proof]
=== CAP Theory proof

image::cap-theory-proof.jpg[CAP Theorem, align="center"]

* 1999 — Ерік Брюер (Eric Brewer) сформулював гіпотезу CAP на конференції PODC (Principles of Distributed Computing);
* 2002 — гіпотеза була математично доведена Сетом Ґілбертом (Seth Gilbert) і Ненсі Лінч (Nancy Lynch) з MIT у статті:

____
Gilbert, S., & Lynch, N. (2002).
Brewer’s conjecture and the feasibility of consistent, available, partition-tolerant web services.
ACM SIGACT News, 33(2), 51–59.
____

.Доказ

1. Є два вузли n1 і n2, які обслуговують клієнтів c1 і c2 відповідно. В обох вузлів є копія деякого значення x (наприклад, баланс рахунку).
2. Відбувається розділення мережі (partition): n1 і n2 більше не можуть обмінюватися повідомленнями. Обидва вузли залишаються живими і доступними для клієнтів.
3. Клієнт c1 надсилає до n1 операцію запису: x = 1 (наприклад, змінити баланс на 1).
4. Одночасно клієнт c2 надсилає до n2 операцію читання: get(x) — дізнатися поточне значення x.

.Суперечність:

1. Якщо n2 негайно повертає значення x, то воно буде застарілим (бо не знає, що x = 1 вже записане на n1). ➜ порушена узгодженість (C).
2. Якщо n2 не відповідає, чекаючи на підтвердження від n1, то клієнт c2 не отримає відповіді. ➜ порушена доступність (A).

Оскільки вузли не можуть комунікувати (через P), система не може забезпечити і C, і A одночасно.

IMPORTANT: Це і є формальна суперечність, яка доводить CAP-теорему: в умовах Partition (P) неможливо мати одночасно Consistency (C) та Availability (A).

.Висновок:

CAP — не просто гіпотеза чи «архітектурний вибір». Це математичне обмеження, яке неможливо обійти.
Будь-яке реальне рішення — це компроміс між C, A, P залежно від пріоритетів системи.
