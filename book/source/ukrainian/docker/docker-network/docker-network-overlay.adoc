ifndef::imagesdir[:imagesdir: ../../../imgs/]

[#docker-network-overlay]
==== Overlay Network

image::docker/docker-network-overlay.jpg[Docker Overlay Network, align="center"]

[[docker-network-overlay-definition]]*overlay* — це тип мережі Docker, який дозволяє контейнерам спілкуватися між собою, які запущені на різних Docker-хостах, об'єднуючи їх у єдину віртуальну мережу. Overlay-мережа працює поверх (over) фізичної мережі і забезпечує спілкування між контейнерами, які знаходяться на різних вузлах кластеру (наприклад, у Docker Swarm або Kubernetes). `Overlay` мережі забезпечують високу ізоляцію та безпеку, дозволяючи контейнерам на різних хостах спілкуватися між собою через <<ingress,Ingress>>.

[[docker-network-overlay-main-properties]]
Основні властивості мережі `overlay`:

* Дозволяє контейнерам на різних хостах обмінюватися даними як у локальній мережі;
* Використовує VXLAN-тунелювання поверх фізичної мережі;
* Працює лише у кластерному середовищі (Docker Swarm або з зовнішнім key-value store);
* Підтримує <<service-discovery,Service Discovery>> (за іменами сервісів) та балансування навантаження;
* Забезпечує базову ізоляцію між overlay-мережами.

[[docker-network-overlay-usage]]
Мережа overlay використовується в наступних випадках:

* Розподілені застосунки: Коли контейнери одного сервісу розгорнуті на різних фізичних/віртуальних машинах;
* Docker Swarm / Kubernetes: Для забезпечення міжвузлового зв’язку між контейнерами;
* <<service-discovery,Service Discovery>> та масштабування: Коли необхідно, щоб нові репліки сервісу автоматично приєднувалися до мережі.


[[docker-network-overlay-pros-and-cons]]
`Overlay` pros and cons:

Pros:

* Підтримка кластерів: Єдиний простір IP-адрес між хостами в кластері;
* Автоматичне тунелювання: Не потрібно вручну налаштовувати маршрути чи VPN — Docker сам створює тунелі;
* <<service-discovery,Service Discovery>>: <<domain-name-system,DNS>> всередині overlay-мережі дозволяє звертатися до сервісів за іменами;
* Вбудоване балансування навантаження між репліками сервісів;
* Безпека: Ізоляція мереж за замовчуванням, шифрування трафіку між хостами (опціонально).

Cons:

* Складність налаштування: Потребує Docker Swarm або окремого ключ-значення сховища (etcd, Consul);
* Затримки: Через тунелювання можуть бути трохи більші затримки, ніж у host чи bridge;
* Залежність від інфраструктури: Не працює у standalone Docker без Swarm або подібної оркестрації;
* Налагодження може бути складним через багаторівневу мережеву архітектуру (VXLAN, iptables, DNS, routing).

[[docker-network-overlay-problem]]
Потенційні проблеми з `overlay`:

* Проблеми з DNS-рішенням, якщо сервіси неправильно зареєстровані;
* Помилки маршрутизації, коли хости не можуть зв’язатися через фізичну мережу;
* Налаштування firewall/iptables: Потрібно відкривати додаткові порти (наприклад, 7946, 4789) між вузлами;
* Складність дебагу: Через віртуальні тунелі складніше діагностувати проблеми з мережею;
* Проблеми сумісності: Застарілі драйвери чи ядра ОС можуть не підтримувати VXLAN.

[[docker-network-overlay-main-features]]
Головні особливості мережі `overlay`:

* Дозволяє контейнерам на різних хостах обмінюватися даними так, ніби вони в одній локальній мережі;
* Працює поверх існуючої інфраструктури — без необхідності створювати окрему фізичну мережу;
* Підтримує масштабування та балансування у кластері;
* Використовується для побудови кластеризованих мікросервісів.
