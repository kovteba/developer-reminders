ifndef::imagesdir[:imagesdir: source/imgs/]

[#docker-image]
=== Docker Image

image::docker/docker-image.jpg[Docker Image, align="center"]

[[docker-image-definition]]*Docker Image* — це незмінний (immutable) шаблон, який містить все необхідне для запуску додатку в контейнері: вихідний код, залежності, бібліотеки, системні утиліти та конфігурацію середовища. Образ формується на основі <<docker-dockerfile,Dockerfile>> — спеціального файлу інструкцій, який описує процес створення образу.

[[docker-image-structure]]Структура Docker Image:

* *Layers* — шари, які являють собою окремі зміни в образі. Кожен шар є результатом виконання команди в Dockerfile;
* *Filesystem* — файловий простір, який містить всі файли та каталоги, необхідні для роботи додатку;
* *Metadata* — метадані, які містять інформацію про образ, такі як автор, версія, команди запуску тощо.

[[docker-image-layers]]Кожен Docker Image складається з одного або декількох шарів. Шари дозволяють ефективно використовувати дисковий простір, оскільки спільні шари між образами не дублюються. Коли ви змінюєте образ, створюється новий шар, який містить лише зміни, а попередні шари залишаються незмінними.

[[docker-layer]]*Layer (слой)* — це один з шарів, з яких складається Docker-образ. Кожен слой являє собою результат виконання однієї інструкції (RUN, COPY тощо) в Dockerfile. [[docker-layer-cache]]Docker кешує ці шари, якщо в Dockerfile нічого не змінилось ні інструкція, ні файли які впливають на слой, Docker використовує кеш що прискорює збірку та дозволяє перевикористовувати вже побудовані частини. Але якщо один слой змінився, то всі наступні шари перезбираються

[[docker-image-types]]Існують різні типи Docker Image:

* *Base Images* — базові образи, які містять лише операційну систему або мінімальний набір інструментів. Наприклад, `alpine`, `ubuntu`, `debian`.
* *Application Images* — образи, які містять готові до запуску додатки. Наприклад, `nginx`, `mysql`, `node`.
* *Custom Images* — користувацькі образи, створені на основі базових образів з додаванням власних файлів та налаштувань.

[[docker-secret]]Секрети, паролі або ключі не варто зберігати всередені образу. Краще передавати їх через зовнішні змінні середовища, Docker secrets (Swarm), Kubernetes secrets або сторонні сховища (Vault), щоб мінімізувати ризик витоку.

Нжче приведені базові команда для роботи в Docker Image:

[[docker-image-creation]]Образи створюються за допомогою команди `docker build`, яка читає <<docker-dockerfile,Dockerfile>> і створює образ на основі вказаних інструкцій. Наприклад:

[source,shell]
----
docker build -t myapp:latest .
----

Ця команда створює образ з тегом `myapp:latest` на основі <<docker-dockerfile,Dockerfile>> в поточній директорії. Це простий варіант створення. Є більш екзотичний як Multi-stage build. [[docker-multi-stage-build]]*Multi-stage build* - це способ розділити сборку на кілька "етапів" (FROM ... AS builder, FROM ... AS runtime) та передавати артефакти, (наприклад, скомпільовані бінарники) з одного етапу в інший. Це зменшує кінцевий образ, оскільки в ньому не залишаються зайві інструменти збірки. Далі наведемо приклад Dockerfile:

[source, dockerfile]
----
FROM golang:1.16 AS builder
WORKDIR /app
COPY . .
RUN go build -o /app/app

FROM alpine:3.14
COPY --from=builder /app/app /app/app
CMD ["/app/app"]
----

[[docker-image-pulling]]Образи можна завантажувати з Docker Hub або інших реєстрів за допомогою команди `docker pull`. Наприклад:

[source,shell]
----
docker pull nginx:latest
----

Ця команда завантажує останню версію образу Nginx з Docker Hub.

[[docker-image-pushing]]Щоб опублікувати свій образ в Docker Hub або іншому реєстрі, використовуйте команду `docker push`. Перед цим потрібно увійти в реєстр за допомогою `docker login`. Наприклад:

[source,shell]
----
docker login
docker push myusername/myapp:latest
----

[[docker-image-tagging]]Образи можна тегувати для зручності ідентифікації. Тегування дозволяє створювати різні версії одного образу. Наприклад:

[source,shell]
----
docker tag myapp:latest myapp:v1.0
----

Ця команда створює тег `v1.0` для образу `myapp:latest`. Тепер ви можете використовувати обидва теги для запуску контейнерів.

[[docker-image-inspection]]Щоб переглянути інформацію про образ, використовуйте команду `docker inspect`. Наприклад:

[source,shell]
----
docker inspect myapp:latest
----

Ця команда виведе детальну інформацію про образ, включаючи шари, метадані та налаштування.

[[docker-image-remove]]Для видалення образу використовуйте команду `docker rmi`. Наприклад:

[source,shell]
----
docker rmi myapp:latest
----

Ця команда видаляє образ `myapp:latest`. Якщо образ використовується в контейнерах, потрібно спочатку зупинити та видалити ці контейнери.
